<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Banerjee Mart - Login / Register</title>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-storage-compat.js"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 400px;
      margin: 30px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      color: #333;
    }

    .input-group {
      margin-bottom: 15px;
      position: relative;
    }

    .input-group i {
      position: absolute;
      top: 12px;
      left: 10px;
      color: #666;
    }

    .input-group input {
      width: 100%;
      padding: 10px 10px 10px 30px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    .input-group input[type="file"] {
      padding-left: 0;
    }

    button {
      width: 100%;
      padding: 10px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background: #0056b3;
    }

    .toggle {
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
    }

    .toggle span {
      color: #007bff;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    .message {
      text-align: center;
      color: red;
      margin: 10px 0;
    }

    #photoPreview {
      display: block;
      margin: 10px auto;
      max-width: 80px;
      border-radius: 50%;
    }
  </style>
</head>
<body>

<div class="container">
  <h2 id="formTitle">Login</h2>

  <div class="message" id="message"></div>

  <!-- Login Form -->
  <form id="loginForm">
    <div class="input-group">
      <i class="fas fa-phone-alt"></i>
      <input type="text" placeholder="Phone Number" id="loginPhone" required>
    </div>
    <div class="input-group">
      <i class="fas fa-lock"></i>
      <input type="password" placeholder="Password" id="loginPassword" required>
    </div>
    <button type="submit">Login</button>
  </form>

  <!-- Register Form -->
  <form id="registerForm" class="hidden">
    <div class="input-group">
      <i class="fas fa-user"></i>
      <input type="text" placeholder="Full Name" id="regName" required>
    </div>
    <div class="input-group">
      <i class="fas fa-phone-alt"></i>
      <input type="text" placeholder="Phone Number" id="regPhone" required>
    </div>
    <div class="input-group">
      <i class="fas fa-envelope"></i>
      <input type="email" placeholder="Email Address (optional)" id="regEmail">
    </div>
    <div class="input-group">
      <i class="fas fa-home"></i>
      <input type="text" placeholder="Address" id="regAddress" required>
    </div>
    <div class="input-group">
      <i class="fas fa-lock"></i>
      <input type="password" placeholder="Password" id="regPassword" required>
    </div>
    <div class="input-group">
      <input type="file" id="regPhoto" accept="image/*">
    </div>
    <img id="photoPreview" src="" class="hidden">
    <button type="submit">Register</button>
  </form>

  <!-- Forgot Password Form -->
  <form id="forgotForm" class="hidden">
    <div class="input-group">
      <i class="fas fa-envelope"></i>
      <input type="email" placeholder="Email Address" id="forgotEmail" required>
    </div>
    <button type="submit">Send Reset Link</button>
  </form>

  <div class="toggle">
    <span onclick="showForm('login')">Login</span> |
    <span onclick="showForm('register')">Register</span> |
    <span onclick="showForm('forgot')">Forgot Password</span>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBbBiAnCjdEcv2PdTRGDuI_eDnTfnnK8g8",
    authDomain: "banerjee-mart.firebaseapp.com",
    projectId: "banerjee-mart",
    storageBucket: "banerjee-mart.appspot.com",
    messagingSenderId: "183628570952",
    appId: "1:183628570952:web:3028bb258001d004d9537d"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const message = document.getElementById("message");

  function showForm(form) {
    document.getElementById("loginForm").classList.add("hidden");
    document.getElementById("registerForm").classList.add("hidden");
    document.getElementById("forgotForm").classList.add("hidden");

    document.getElementById("formTitle").textContent = form.charAt(0).toUpperCase() + form.slice(1);

    if (form === "login") document.getElementById("loginForm").classList.remove("hidden");
    if (form === "register") document.getElementById("registerForm").classList.remove("hidden");
    if (form === "forgot") document.getElementById("forgotForm").classList.remove("hidden");

    message.textContent = "";
  }

  // Preview photo
  document.getElementById("regPhoto").addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (event) {
        const img = document.getElementById("photoPreview");
        img.src = event.target.result;
        img.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    }
  });

  // Register
  document.getElementById("registerForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const name = document.getElementById("regName").value;
    const phone = document.getElementById("regPhone").value;
    const email = document.getElementById("regEmail").value || `${phone}@banerjeemart.com`;
    const address = document.getElementById("regAddress").value;
    const password = document.getElementById("regPassword").value;
    const photoFile = document.getElementById("regPhoto").files[0];

    try {
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      const uid = userCredential.user.uid;
      let photoURL = "";

      if (photoFile) {
        const storageRef = storage.ref().child("users/" + uid + "/photo.jpg");
        await storageRef.put(photoFile);
        photoURL = await storageRef.getDownloadURL();
      }

      await db.collection("users").doc(uid).set({
        name, phone, email, address, photoURL
      });

      message.textContent = "Registered successfully!";
      showForm("login");
    } catch (error) {
      message.textContent = error.message;
    }
  });

  // Login
  document.getElementById("loginForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const phone = document.getElementById("loginPhone").value;
    const password = document.getElementById("loginPassword").value;
    const email = `${phone}@banerjeemart.com`;

    try {
      await auth.signInWithEmailAndPassword(email, password);
      window.location.href = "index.html";
    } catch (error) {
      message.textContent = error.message;
    }
  });

  // Forgot Password
  document.getElementById("forgotForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const email = document.getElementById("forgotEmail").value;
    try {
      await auth.sendPasswordResetEmail(email);
      message.textContent = "Reset link sent. Check your inbox.";
    } catch (error) {
      message.textContent = error.message;
    }
  });

</script>
</body>
      </html>
