<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Banerjee Mart - Auth</title>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-storage.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body {
      font-family: sans-serif;
      background: #f1f3f6;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px;
    }
    .container {
      background: white;
      padding: 25px;
      border-radius: 8px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .photo-upload {
      margin-bottom: 15px;
    }
    .photo-preview {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 50%;
      display: block;
      margin: 10px auto;
    }
    button {
      width: 100%;
      padding: 12px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
    }
    button:hover {
      background: #45a049;
    }
    .message {
      text-align: center;
      color: red;
      margin-top: 10px;
    }
    .toggle-link {
      text-align: center;
      margin-top: 10px;
      cursor: pointer;
      color: #007bff;
    }
  </style>
</head>
<body>

<div class="container" id="registerForm">
  <h2><i class="fas fa-user-plus"></i> Register</h2>
  <input type="text" id="regName" placeholder="Full Name" required>
  <input type="text" id="regPhone" placeholder="Phone Number" required>
  <input type="email" id="regEmail" placeholder="Email (optional)">
  <select id="regAddress">
    <option value="" disabled selected>Select Address</option>
    <option value="Pakurtala">Pakurtala</option>
    <option value="Rajuakhaki">Rajuakhaki</option>
  </select>
  <input type="file" id="regPhoto" accept="image/*" class="photo-upload">
  <input type="password" id="regPassword" placeholder="Password" required>
  <button onclick="register()">Register</button>
  <div class="message" id="regMessage"></div>
  <div class="toggle-link" onclick="showLogin()">Already have an account? Login</div>
</div>

<div class="container" id="loginForm" style="display:none;">
  <h2><i class="fas fa-sign-in-alt"></i> Login</h2>
  <input type="text" id="loginPhone" placeholder="Phone Number">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="login()">Login</button>
  <div class="message" id="loginMessage"></div>
  <div class="toggle-link" onclick="showRegister()">Don't have an account? Register</div>
</div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyBbBiAnCjdEcv2PdTRGDuI_eDnTfnnK8g8",
    authDomain: "banerjee-mart.firebaseapp.com",
    projectId: "banerjee-mart",
    storageBucket: "banerjee-mart.appspot.com",
    messagingSenderId: "183628570952",
    appId: "1:183628570952:web:3028bb258001d004d9537d"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  function showLogin() {
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('loginForm').style.display = 'block';
  }

  function showRegister() {
    document.getElementById('registerForm').style.display = 'block';
    document.getElementById('loginForm').style.display = 'none';
  }

  async function register() {
    const name = document.getElementById('regName').value;
    const phone = document.getElementById('regPhone').value;
    const email = document.getElementById('regEmail').value || '';
    const address = document.getElementById('regAddress').value;
    const password = document.getElementById('regPassword').value;
    const photoFile = document.getElementById('regPhoto').files[0];
    const regMessage = document.getElementById('regMessage');

    if (!name || !phone || !password || !address) {
      regMessage.textContent = 'Please fill all required fields.';
      return;
    }

    try {
      const userCredential = await auth.createUserWithEmailAndPassword(`${phone}@banerjeemart.com`, password);
      const user = userCredential.user;

      let photoURL = '';
      if (photoFile) {
        const storageRef = storage.ref().child(`users/${user.uid}/profile.jpg`);
        await storageRef.put(photoFile);
        photoURL = await storageRef.getDownloadURL();
      }

      await db.collection('users').doc(user.uid).set({
        name,
        phone,
        email,
        address,
        imageUrl: photoURL
      });

      regMessage.style.color = 'green';
      regMessage.textContent = 'Registration successful. Redirecting...';
      setTimeout(() => window.location.href = 'index.html', 1500);
    } catch (error) {
      regMessage.style.color = 'red';
      regMessage.textContent = error.message;
    }
  }

  async function login() {
    const phone = document.getElementById('loginPhone').value;
    const password = document.getElementById('loginPassword').value;
    const loginMessage = document.getElementById('loginMessage');

    try {
      await auth.signInWithEmailAndPassword(`${phone}@banerjeemart.com`, password);
      loginMessage.style.color = 'green';
      loginMessage.textContent = 'Login successful. Redirecting...';
      setTimeout(() => window.location.href = 'index.html', 1500);
    } catch (error) {
      loginMessage.style.color = 'red';
      loginMessage.textContent = error.message;
    }
  }
</script>

</body>
</html>
